<html>
  <head>
    <link href="/favicon.ico" rel="icon" type="image/x-icon" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="/swfobject.js" type="text/javascript"></script>
    <script src="/jquery-1.6.4.min.js" type="text/javascript"></script>
    <script src="/jquery.json-2.3.min.js" type="text/javascript"></script>
    <script src="/Fingerprint.js" type="text/javascript"></script>
    <script type="text/javascript">
      var statusTimeout;
      $(function(){
        $('#share').bind('click',submit)
                   .bind('mouseenter',function(){ $(this).attr('src','/share_hover.png'); })
                   .bind('mouseleave',function(){ $(this).attr('src','/share.png'); });
        $('#info').bind('click',info);

        Fingerprint.events.add(Fingerprint.updateRTT,[10,'/time'])
                          .add(Fingerprint.initFlash,['/Fonts.swf'])
                          .add(Fingerprint.updatePlugins,[navigator.userAgent])
                          .run();

        Fingerprint.status.onChange = updateStatus;

      });

      var tmp = <%= @fingerprint.to_json %>;

      Fingerprint.init(tmp);
      function submit()
      {
        $('#status').removeClass('orange');
        $('#share').attr('src','/loading.gif')
                   .css('cursor','default')
                   .unbind();
        $('#init>p').fadeOut('fast',function(){
          $(this).css('display','')
                 .css('visibility','hidden');
        });
        Fingerprint.onFinish(function()
        { 
            clearTimeout(statusTimeout);
            $('#status').text('Sending data...');
            Fingerprint.submit('/post',function error()
            {
                $('#init').fadeIn('fast');
                $('#status').text('Something went wrong, we are sorry for the inconvinience! Please try again later.')
                            .removeClass().addClass('orange');
                $('#share').fadeOut('fast',function(){
                  $(this).css('display','')
                         .css('visibility','hidden');
                });
      
            },
            function success()
            {
                $('#init').fadeOut('fast');
                $('#fingerprint').children().remove('table.obj');
                $('#fingerprint').css('display','block');
                $('#fingerprint').prepend(Fingerprint.generateDOM());
            });
        });
      }
      function updateStatus()
      {
        var status = Fingerprint.status.get();
        $('#status').text(status);
      }
      function info()
      {
        if ( !$('#info:visible').length )
        {
          $('#info').fadeIn('fast').load('/info',function(response, status, xhr)
          { 
            $(this).children().addClass('done');
          });
        }
        else $('#info').fadeOut('fast');
        return false;
      }

</script>
    <title>Browser Fingerprinting</title>
    <link rel="stylesheet" type="text/css" href="/style.css" />
  </head>
  <body>
    <div id="init">
      <h1>Browser Fingerprinting</h1>
      <p>
	Please support our Master's Thesis research by sharing your browser's
	fingerprint with us. <br/>You need not worry, we wont share your data with
	anyone under any circumstances.
      </p>
      <img src="/share.png" id="share" alt="" />
      <p class="disclaimer">
	Upon clicking Share, you agree to letting us store information about your browser. <br/>
	Burt AB is in no way affiliated with this webpage. <a href="#" onclick="info()" />More info</a>.
      </p>
      <div id="status" class="audit"></div>
    </div>

    <div id="info">
      <div><p>&nbsp;</p></div>
    </div>

    <div id="thanks">
      <h1>Thank you for sharing!</h1>
      <div id="fingerprint"></div>
    </div>

  </body>
</html>
